openapi: 3.0.0
info:
  title: Analysis API
  version: 1.0.0
  description: |-
    Core risk analysis and calculations for the Risk Management System.
    
    This API provides:
    - **Portfolio Risk Analysis** - VaR, Sharpe Ratio, Beta, Standard Deviation calculations
    - **Concentration Risk Detection** - Single position, sector, and top-5 holdings analysis
    - **Suitability Assessment** - Portfolio vs risk profile alignment checks
    - **Stress Testing** - Scenario analysis with historical and hypothetical scenarios
    - **Comprehensive Analysis** - Full risk analysis combining all metrics

    ## Authentication
    This is a demo API with **no authentication required**.

    ## Data Note
    This system uses an **in-memory datastore** that resets when the server restarts.
  contact:
    name: API Support
    email: support@riskmanagement.demo
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC
servers:
  - url: https://risk-management-system-f04b786dc797.herokuapp.com/api/v1
    description: Production server (Heroku)
  - url: http://localhost:3002/api/v1
    description: Local development server
tags:
  - name: Analysis
    description: Core risk analysis and calculations
components:
  schemas:
    Holding:
      type: object
      properties:
        symbol:
          type: string
          example: AAPL
        securityType:
          type: string
          example: STOCK
        sector:
          type: string
          example: TECHNOLOGY
        marketValue:
          type: number
          example: 35700
        weight:
          type: number
          example: 7.36
        beta:
          type: number
          example: 1.25
        annualizedVolatility:
          type: number
          example: 28.5
    PortfolioData:
      type: object
      required:
        - totalValue
        - holdings
      properties:
        totalValue:
          type: number
          example: 485000
        holdings:
          type: array
          items:
            $ref: '#/components/schemas/Holding'
        cashPosition:
          type: number
          example: 15000
        assetAllocation:
          type: object
          properties:
            equities:
              type: number
            fixedIncome:
              type: number
            alternatives:
              type: number
            cash:
              type: number
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        timestamp:
          type: string
          format: date-time
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: NOT_FOUND
            message:
              type: string
              example: Resource not found
        timestamp:
          type: string
          format: date-time
paths:
  /analysis/portfolio-risk:
    post:
      summary: Calculate portfolio risk metrics
      description: Analyzes portfolio and calculates comprehensive risk metrics including VaR, Sharpe ratio, beta, and more
      tags:
        - Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - portfolioData
              properties:
                investorId:
                  type: string
                  example: INV-001
                portfolioData:
                  $ref: '#/components/schemas/PortfolioData'
                benchmarkSymbol:
                  type: string
                  example: SPY
            example:
              investorId: INV-001
              portfolioData:
                totalValue: 485000
                holdings:
                  - symbol: AAPL
                    securityType: STOCK
                    sector: TECHNOLOGY
                    marketValue: 35700
                    weight: 7.36
                    beta: 1.25
                  - symbol: MSFT
                    securityType: STOCK
                    sector: TECHNOLOGY
                    marketValue: 63000
                    weight: 13
                    beta: 1.15
                cashPosition: 15000
              benchmarkSymbol: SPY
      responses:
        '200':
          description: Portfolio risk analysis complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      investorId:
                        type: string
                      analysisDate:
                        type: string
                        format: date-time
                      portfolioMetrics:
                        type: object
                        properties:
                          totalValue:
                            type: number
                            example: 485000
                          portfolioVolatility:
                            type: number
                            description: Annual standard deviation %
                            example: 14.5
                          portfolioBeta:
                            type: number
                            example: 1.12
                          sharpeRatio:
                            type: number
                            example: 1.25
                          sortinoRatio:
                            type: number
                            example: 1.45
                          treynorRatio:
                            type: number
                            example: 0.08
                          informationRatio:
                            type: number
                            example: 0.42
                          maxDrawdown:
                            type: number
                            example: -18.5
                          valueAtRisk:
                            type: object
                            properties:
                              var95_percent:
                                type: number
                              var95_dollar:
                                type: number
                              var99_percent:
                                type: number
                              var99_dollar:
                                type: number
                          trackingError:
                            type: number
                            example: 3.2
                          rSquared:
                            type: number
                            example: 0.89
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: Invalid input - portfolioData with holdings is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /analysis/concentration:
    post:
      summary: Analyze concentration risk
      description: Analyzes portfolio concentration including single position, sector, and top-5 holdings risk
      tags:
        - Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - holdings
              properties:
                investorId:
                  type: string
                  example: INV-001
                holdings:
                  type: array
                  items:
                    type: object
                    properties:
                      symbol:
                        type: string
                      sector:
                        type: string
                      weight:
                        type: number
                  example:
                    - symbol: AAPL
                      sector: TECHNOLOGY
                      weight: 22.5
                    - symbol: MSFT
                      sector: TECHNOLOGY
                      weight: 18.2
                thresholds:
                  type: object
                  properties:
                    singlePositionLimit:
                      type: number
                      default: 10
                    sectorLimit:
                      type: number
                      default: 25
                    top5Limit:
                      type: number
                      default: 50
      responses:
        '200':
          description: Concentration analysis complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      concentrationAnalysis:
                        type: object
                        properties:
                          singlePosition:
                            type: object
                            properties:
                              topHolding:
                                type: string
                              topHoldingWeight:
                                type: number
                              limit:
                                type: number
                              status:
                                type: string
                                enum:
                                  - OK
                                  - BREACHED
                              breach:
                                type: number
                          sectorConcentration:
                            type: object
                            properties:
                              topSector:
                                type: string
                              topSectorWeight:
                                type: number
                              status:
                                type: string
                              sectorBreakdown:
                                type: object
                          top5Concentration:
                            type: object
                          herfindahlIndex:
                            type: number
                            description: Concentration measure 0-1
                          effectivePositions:
                            type: number
                          overallConcentrationRisk:
                            type: string
                            enum:
                              - LOW
                              - MODERATE
                              - ELEVATED
                              - HIGH
                      alerts:
                        type: array
                        items:
                          type: object
                          properties:
                            alertType:
                              type: string
                            severity:
                              type: string
                            message:
                              type: string
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: Holdings array is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /analysis/suitability:
    post:
      summary: Check portfolio suitability vs profile
      description: Compares portfolio characteristics against investor's risk profile to assess suitability
      tags:
        - Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - investorId
                - portfolioData
              properties:
                investorId:
                  type: string
                  example: INV-001
                portfolioData:
                  type: object
                  properties:
                    totalValue:
                      type: number
                    portfolioVolatility:
                      type: number
                    portfolioBeta:
                      type: number
                    maxDrawdown:
                      type: number
                    assetAllocation:
                      type: object
                      properties:
                        equities:
                          type: number
                        fixedIncome:
                          type: number
                        alternatives:
                          type: number
                        cash:
                          type: number
                    topHoldingWeight:
                      type: number
                    sectorConcentration:
                      type: object
      responses:
        '200':
          description: Suitability assessment complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      suitabilityAssessment:
                        type: object
                        properties:
                          overallRating:
                            type: string
                            enum:
                              - HIGHLY_SUITABLE
                              - SUITABLE
                              - SUITABLE_WITH_CAVEATS
                              - REVIEW_REQUIRED
                              - NOT_SUITABLE
                          overallScore:
                            type: number
                          recommendation:
                            type: string
                          dimensions:
                            type: object
                            properties:
                              riskAlignment:
                                type: object
                              allocationAlignment:
                                type: object
                              concentrationCompliance:
                                type: object
                              timeHorizonFit:
                                type: object
                      riskProfile:
                        type: object
                        properties:
                          profileId:
                            type: string
                          riskCategory:
                            type: string
                          maxVolatilityTolerance:
                            type: number
                          maxDrawdownTolerance:
                            type: number
                      actionRequired:
                        type: boolean
                      requiredActions:
                        type: array
                        items:
                          type: string
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: investorId and portfolioData are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /analysis/stress-test:
    post:
      summary: Run stress test scenario
      description: Applies stress test scenario(s) to a portfolio and calculates potential impact
      tags:
        - Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - investorId
                - portfolioData
              properties:
                investorId:
                  type: string
                  example: INV-001
                scenarioId:
                  type: string
                  description: Single scenario ID
                  example: SCN-001
                scenarioIds:
                  type: array
                  description: Multiple scenario IDs (alternative to scenarioId)
                  items:
                    type: string
                  example:
                    - SCN-001
                    - SCN-002
                    - SCN-005
                portfolioData:
                  type: object
                  required:
                    - totalValue
                    - holdings
                  properties:
                    totalValue:
                      type: number
                    holdings:
                      type: array
                      items:
                        type: object
                        properties:
                          symbol:
                            type: string
                          sector:
                            type: string
                          marketValue:
                            type: number
                          weight:
                            type: number
      responses:
        '200':
          description: Stress test complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      scenarioResults:
                        type: object
                        properties:
                          scenarioId:
                            type: string
                          scenarioName:
                            type: string
                          portfolioImpact:
                            type: object
                            properties:
                              currentValue:
                                type: number
                              stressedValue:
                                type: number
                              dollarLoss:
                                type: number
                              percentageLoss:
                                type: number
                              recoveryTime:
                                type: string
                          holdingImpacts:
                            type: array
                            items:
                              type: object
                          worstHit:
                            type: array
                            items:
                              type: object
                          bestProtected:
                            type: array
                            items:
                              type: object
                      riskProfileComparison:
                        type: object
                        properties:
                          maxDrawdownTolerance:
                            type: number
                          scenarioDrawdown:
                            type: number
                          exceedsToleranceBy:
                            type: number
                          warning:
                            type: string
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /analysis/comprehensive:
    post:
      summary: Full risk analysis (all metrics)
      description: Performs comprehensive risk analysis including portfolio risk, concentration, suitability, optional stress tests, and generates recommendations
      tags:
        - Analysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - investorId
                - portfolioData
              properties:
                investorId:
                  type: string
                  example: INV-001
                portfolioData:
                  $ref: '#/components/schemas/PortfolioData'
                includeStressTests:
                  type: boolean
                  default: false
                scenarioIds:
                  type: array
                  items:
                    type: string
                  example:
                    - SCN-001
                    - SCN-002
                    - SCN-005
                benchmarkSymbol:
                  type: string
                  default: SPY
      responses:
        '200':
          description: Comprehensive analysis complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      investorId:
                        type: string
                      analysisTimestamp:
                        type: string
                        format: date-time
                      portfolioRisk:
                        type: object
                        description: Full portfolio risk metrics
                      concentrationAnalysis:
                        type: object
                        description: Full concentration analysis
                      suitabilityAssessment:
                        type: object
                        description: Full suitability assessment
                      stressTestResults:
                        type: array
                        description: Array of stress test results (if requested)
                        nullable: true
                        items:
                          type: object
                      recommendations:
                        type: object
                        description: Generated recommendations
                      executiveSummary:
                        type: object
                        properties:
                          overallRiskLevel:
                            type: string
                            enum:
                              - LOW
                              - MODERATE
                              - MODERATE_HIGH
                              - HIGH
                          keyFindings:
                            type: array
                            items:
                              type: string
                          priorityActions:
                            type: array
                            items:
                              type: string
                          nextReviewDate:
                            type: string
                            format: date
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: investorId and portfolioData are required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Investor not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

